# ZAP Pentest Automation â€“ Kubernetes Quick Start

This guide explains how to run an automated ZAP penetration test job in Kubernetes, and how to view the results via a web-based report viewer.

---

## Prerequisites

- Your ZAP configuration, scripts, and collections are present on your local machine in `D:\DEV\ZAP` as follows:
    - `D:\DEV\ZAP\config\automation.yaml`
    - `D:\DEV\ZAP\postman\postman-collection.json`
    - `D:\DEV\ZAP\scripts\active\...`
    - `D:\DEV\ZAP\scripts\httpsender\...`
- Your custom ZAP Docker image (e.g., `stefangolubov/zap-custom:latest`) is built and pushed to a registry accessible by your Kubernetes cluster.

---

## 1. Apply the Persistent Volume Claim

This PVC is used to store generated reports and to share them between the ZAP job and the report viewer.

```sh
kubectl apply -f reports\pvc.yaml
```

---

## 2. Deploy the Report Viewer

This deployment runs an Nginx server that serves the reports written to the PVC.

```sh
kubectl apply -f reports\deployment.yaml
```

---

## 3. Expose the Report Viewer with a Service

This service exposes the report viewer on a node port (default: 30080).

```sh
kubectl apply -f reports\service.yaml
```

---

## 4. Verify Report Viewer Works

After a minute or so, open your browser and visit:

```
http://<your-node-ip>:30080/
```

You should see the Nginx directory listing. (There may be no reports yet until the next step is completed.)

---

## 5. Run the ZAP Pentest Job

This will mount your ZAP configs/scripts from your host, run the pentest, and write the reports into the shared PVC.

```sh
kubectl apply -f zap-pentest-job.yaml
```

You can monitor the job with:

```sh
kubectl get pods -w
kubectl logs -f <zap-pentest-job-pod-name>
```

---

## 6. View the Test Reports

After the ZAP job completes, reports will appear in the `/zap` directory served by the report viewer.

- Open: `http://<your-node-ip>:30080/zap/`
    - Find the most recent `.html` or `.json` files (`manual-pen-test-<timestamp>.html`, etc.)
- To view the ZAP/Burp comparison endpoint (if configured):
    - Open: `http://<your-node-ip>:30080/compare`

---

## 7. (Optional) Cleanup

To remove test resources:

```sh
kubectl delete job zap-pentest-job
kubectl delete deployment report-viewer
kubectl delete service report-service
kubectl delete pvc reports-pvc
```

---

## Notes

- If you update your ZAP scripts/configs, re-run the pentest job.
- If you need to mount the ZAP files from a different path, update the `zap-pentest-job.yaml` volume definition.
- You can run multiple pentest jobs; each will write a timestamped report to the shared PVC, visible in the report viewer.

---

## Next Steps

A similar quick-start README for Newman-based jobs will follow this pattern.